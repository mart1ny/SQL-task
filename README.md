# Online Store Analytics

–£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç: –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ë–î –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ —Å –ø–æ–ª–Ω—ã–º —Ü–∏–∫–ª–æ–º ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –¥–∞–Ω–Ω—ã–µ, –æ—Ç—á—ë—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —Ö—Ä–∞–Ω–∏–º–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≥–æ—Ç–æ–≤ –∫ –±—ã—Å—Ç—Ä–æ–º—É —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ MySQL 8+.

## –°–æ–¥–µ—Ä–∂–∏–º–æ–µ
| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- |
| `schema.sql` | –°–æ–∑–¥–∞—ë—Ç —Å—Ö–µ–º—É `online_store_analytics`: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ç–æ–≤–∞—Ä—ã, –∑–∞–∫–∞–∑—ã, –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤, –æ—Ç–∑—ã–≤—ã, —Ç–∞–±–ª–∏—Ü–∞ `monthly_reports`. |
| `data.sql` | –ù–∞–ø–æ–ª–Ω—è–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã–º–∏ 2022‚Äì2025 –≥–≥., –≤–∫–ª—é—á–∞—è —Å–≤–µ–∂–∏–µ –∑–∞–∫–∞–∑—ã –∏ –æ—Ç—á—ë—Ç—ã –∑–∞ 2025 –≥–æ–¥. |
| `analytics.sql` | 10 –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ `generate_monthly_report`, —Ñ—É–Ω–∫—Ü–∏—è `calculate_user_rank`. |
| `REPORT.md` | –¢–µ–∫—Å—Ç –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è/–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –æ –ø—Ä–æ–µ–∫—Ç–µ. |

## –°–≤—è–∑–∏ —Ç–∞–±–ª–∏—Ü
```
users ‚îÄ‚îÄ< orders ‚îÄ‚îÄ< order_items >‚îÄ‚îÄ products >‚îÄ‚îÄ categories
   \                          \
    \                          ‚îî‚îÄ‚îÄ reviews >‚îÄ‚îÄ products
     \_______________________________________________/
                    monthly_reports (–∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –º–µ—Å—è—Ü–∞–º)
```
- `users` ‚Üî `orders`: –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–≥–æ –∑–∞–∫–∞–∑–æ–≤.
- `orders` ‚Üî `order_items`: –∫–∞–∂–¥—ã–π –∑–∞–∫–∞–∑ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–∑–∏—Ü–∏–π.
- `order_items` ‚Üî `products`: –ø–æ–∑–∏—Ü–∏—è —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä, —Ç–æ–≤–∞—Ä –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
- `reviews` —Å–≤—è–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç–æ–≤–∞—Ä—ã (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –æ—Ç–∑—ã–≤ –Ω–∞ –ø–∞—Ä—É `user_id + product_id`).
- `monthly_reports` –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ—Ü–µ–¥—É—Ä–æ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞–±–ª–∏—Ü `orders` –∏ `users`.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```bash
# 1. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î
mysql -u root -p -e "DROP DATABASE IF EXISTS online_store_analytics; \
  CREATE DATABASE online_store_analytics CHARACTER SET utf8mb4;"

# 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ + –¥–∞–Ω–Ω—ã–µ + –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
mysql -u root -p online_store_analytics < schema.sql
mysql -u root -p online_store_analytics < data.sql
mysql -u root -p online_store_analytics < analytics.sql
```

–ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
```sql
SHOW TABLES;
SELECT COUNT(*) FROM orders; -- 32 –∑–∞–∫–∞–∑–∞
```

## –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
`analytics.sql` –≤–∫–ª—é—á–∞–µ—Ç:
1. –¢–æ–ø‚Äë5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (CTE + –æ–∫–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `DENSE_RANK`).
2. –õ–∏–¥–µ—Ä—ã —Å—Ä–µ–¥–∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü.
3. –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –ø–æ –º–µ—Å—è—Ü–∞–º –∑–∞ –≥–æ–¥.
4. –ü–∞—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫—É–ø–∞—é—Ç –≤–º–µ—Å—Ç–µ (self join `order_items`).
5. –í–æ—Ä–æ–Ω–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤ —Å –¥–æ–ª—è–º–∏.
6. –†–µ–π—Ç–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ –≤—ã—Ä—É—á–∫–µ.
7. –ö–ª–∏–µ–Ω—Ç—ã –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤ ‚â•30 –¥–Ω–µ–π.
8. –°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂ –ø–æ –Ω–æ–º–µ—Ä—É –º–µ—Å—è—Ü–∞.
9. –†–µ–π—Ç–∏–Ω–≥ –≥–æ—Ä–æ–¥–æ–≤ (–æ–∫–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `RANK`).
10. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–µ–≤ –ø–æ –∫–ª—é—á–µ–≤—ã–º –º–µ—Ç—Ä–∏–∫–∞–º.

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, CTE, –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –∏ –¥–∞—Ç–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ `CURDATE()`.

## –•—Ä–∞–Ω–∏–º–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞
```sql
CALL generate_monthly_report('2025-12-01');
```
–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –º–µ—Å—è—Ü–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç `monthly_reports` (—á–µ—Ä–µ–∑ `ON DUPLICATE KEY UPDATE`) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è
```sql
SELECT calculate_user_rank(21);
```
–§—É–Ω–∫—Ü–∏—è –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–∫–∞–∑—ã, —Ç—Ä–∞—Ç—ã, –æ—Ç–∑—ã–≤—ã, –≤–æ–∑—Ä–∞—Å—Ç –∞–∫–∫–∞—É–Ω—Ç–∞) –∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç —Ä–∞–Ω–≥ 1‚Äì10 –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤.

## –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ GUI
–í TablePlus/Workbench:
1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ `online_store_analytics`.
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `analytics.sql` —Ü–µ–ª–∏–∫–æ–º (`Run All`) ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –≤ 10 –≤–∫–ª–∞–¥–∫–∞—Ö.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –∏ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ —Ä–∞–Ω–≥–∏.
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `REPORT.md` –∫–∞–∫ —Å—Ü–µ–Ω–∞—Ä–∏–π –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è.

## –ü—Ä–æ–≤–µ—Ä–∫–∞
–ü–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π/–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–µ–π:
```sql
SHOW TABLES;
SELECT COUNT(*) FROM users;
CALL generate_monthly_report('2025-12-01');
SELECT calculate_user_rank(21);
```
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã–µ.

–ì–æ—Ç–æ–≤–æ! –ë–∞–∑–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞, –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç ‚Äî –º–æ–∂–Ω–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å. üöÄ
